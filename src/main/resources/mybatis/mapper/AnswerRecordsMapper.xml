<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gaodun.learningservice.mapper.AnswerRecordsMapper">
    
    <!-- 基础结果映射 -->
    <resultMap id="BaseResultMap" type="com.gaodun.learningservice.Entity.AnswerRecordsEntity">
        <id column="record_id" property="recordId" jdbcType="INTEGER"/>
        <result column="exam_name" property="examName" jdbcType="VARCHAR"/>
        <result column="user_id" property="userId" jdbcType="INTEGER"/>
        <result column="start_time" property="startTime" jdbcType="TIMESTAMP"/>
        <result column="end_time" property="endTime" jdbcType="TIMESTAMP"/>
        <result column="time_spent" property="timeSpent" jdbcType="INTEGER"/>
        <result column="status" property="status" jdbcType="TINYINT"/>
        <result column="score" property="score" jdbcType="DECIMAL"/>
        <result column="created_at" property="createdAt" jdbcType="TIMESTAMP"/>
        <result column="updated_at" property="updatedAt" jdbcType="TIMESTAMP"/>
    </resultMap>
    
    <!-- 所有字段的SQL片段 -->
    <sql id="Base_Column_List">
        record_id, exam_name, user_id, start_time, end_time, time_spent, status, score, created_at, updated_at
    </sql>
    
    <!-- 根据ID查询答题记录 -->
    <select id="selectById" resultMap="BaseResultMap" parameterType="java.lang.Integer">
        SELECT 
        <include refid="Base_Column_List"/>
        FROM answer_records
        WHERE record_id = #{recordId}
    </select>
    
    <!-- 查询所有答题记录 -->
    <select id="selectAll" resultMap="BaseResultMap">
        SELECT 
        <include refid="Base_Column_List"/>
        FROM answer_records
    </select>
    
    <!-- 根据用户ID查询答题记录 -->
    <select id="selectByUserId" resultMap="BaseResultMap" parameterType="java.lang.Integer">
        SELECT 
        <include refid="Base_Column_List"/>
        FROM answer_records
        WHERE user_id = #{userId}
        ORDER BY start_time DESC
    </select>
    
    <!-- 根据考试名称查询答题记录 -->
    <select id="selectByExamName" resultMap="BaseResultMap" parameterType="java.lang.String">
        SELECT 
        <include refid="Base_Column_List"/>
        FROM answer_records
        WHERE exam_name = #{examName}
        ORDER BY start_time DESC
    </select>
    
    <!-- 根据答题状态查询答题记录 -->
    <select id="selectByStatus" resultMap="BaseResultMap" parameterType="java.lang.Integer">
        SELECT 
        <include refid="Base_Column_List"/>
        FROM answer_records
        WHERE status = #{status}
        ORDER BY start_time DESC
    </select>
    
    <!-- 插入答题记录 -->
    <insert id="insert" parameterType="com.gaodun.learningservice.Entity.AnswerRecordsEntity" useGeneratedKeys="true" keyProperty="recordId">
        INSERT INTO answer_records
        (exam_name, user_id, start_time, end_time, time_spent, status, score, created_at, updated_at)
        VALUES
        (#{examName}, #{userId}, #{startTime}, #{endTime}, #{timeSpent}, #{status}, #{score}, #{createdAt}, #{updatedAt})
    </insert>
    
    <!-- 更新答题记录 -->
    <update id="update" parameterType="com.gaodun.learningservice.Entity.AnswerRecordsEntity">
        UPDATE answer_records
        <set>
            <if test="examName != null">exam_name = #{examName},</if>
            <if test="userId != null">user_id = #{userId},</if>
            <if test="startTime != null">start_time = #{startTime},</if>
            <if test="endTime != null">end_time = #{endTime},</if>
            <if test="timeSpent != null">time_spent = #{timeSpent},</if>
            <if test="status != null">status = #{status},</if>
            <if test="score != null">score = #{score},</if>
            <if test="updatedAt != null">updated_at = #{updatedAt},</if>
        </set>
        WHERE record_id = #{recordId}
    </update>
    
    <!-- 删除答题记录 -->
    <delete id="delete" parameterType="java.lang.Integer">
        DELETE FROM answer_records
        WHERE record_id = #{recordId}
    </delete>
    
</mapper>
