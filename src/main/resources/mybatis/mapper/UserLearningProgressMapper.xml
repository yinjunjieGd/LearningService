<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gaodun.learningservice.mapper.UserLearningProgressMapper">
    
    <resultMap id="BaseResultMap" type="com.gaodun.learningservice.Entity.UserLearningProgressEntity">
        <id column="id" property="id" />
        <result column="user_id" property="userId" />
        <result column="course_id" property="courseId" />
        <result column="progress_percentage" property="progressPercentage" />
        <result column="ai_comment" property="aiComment" />
        <result column="last_study_time" property="lastStudyTime" />
        <result column="status" property="status" />
        <result column="create_time" property="createTime" />
        <result column="update_time" property="updateTime" />
    </resultMap>
    
    <select id="selectById" resultMap="BaseResultMap">
        SELECT * FROM user_learning_progress WHERE id = #{id}
    </select>
    
    <select id="selectByUserId" resultMap="BaseResultMap">
        SELECT * FROM user_learning_progress WHERE user_id = #{userId}
    </select>
    
    <select id="selectByCourseId" resultMap="BaseResultMap">
        SELECT * FROM user_learning_progress WHERE course_id = #{courseId}
    </select>
    
    <select id="selectByUserIdAndCourseId" resultMap="BaseResultMap">
        SELECT * FROM user_learning_progress 
        WHERE user_id = #{userId} AND course_id = #{courseId}
    </select>
    
    <select id="selectAll" resultMap="BaseResultMap">
        SELECT * FROM user_learning_progress
    </select>
    
    <insert id="insert" parameterType="com.gaodun.learningservice.Entity.UserLearningProgressEntity" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO user_learning_progress (
            user_id, course_id, progress_percentage, ai_comment, 
            last_study_time, status, create_time, update_time
        ) VALUES (
            #{userId}, #{courseId}, #{progressPercentage}, #{aiComment}, 
            #{lastStudyTime}, #{status}, #{createTime}, #{updateTime}
        )
    </insert>
    
    <update id="update" parameterType="com.gaodun.learningservice.Entity.UserLearningProgressEntity">
        UPDATE user_learning_progress
        <set>
            <if test="userId != null">user_id = #{userId},</if>
            <if test="courseId != null">course_id = #{courseId},</if>
            <if test="progressPercentage != null">progress_percentage = #{progressPercentage},</if>
            <if test="aiComment != null">ai_comment = #{aiComment},</if>
            <if test="lastStudyTime != null">last_study_time = #{lastStudyTime},</if>
            <if test="status != null">status = #{status},</if>
            <if test="updateTime != null">update_time = #{updateTime}</if>
        </set>
        WHERE id = #{id}
    </update>
    
    <delete id="delete">
        DELETE FROM user_learning_progress WHERE id = #{id}
    </delete>
    
    <delete id="deleteByUserId">
        DELETE FROM user_learning_progress WHERE user_id = #{userId}
    </delete>
    
</mapper>
